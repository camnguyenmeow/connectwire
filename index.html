<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J5C29YHT4F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J5C29YHT4F');
</script>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/jpg" href="./img/ltk13logo.jpg"/>
	<title>Minigame - Clb Lý Tin ^^</title>
	<link rel="stylesheet" href="./css/style.css">
	<style>
		#getinfo {
			text-align: center;
			width: 100%;
			height: auto;
			font-size: 25px;
			display: none;
			position: relative;
		}
		#saveinfo {
			height: 40px;
			width: 100px;
			background-color: yellow; 
			color: black;
			font-size: 16px;
			position: relative;
			margin: 0 auto;
			top: 5px;
			display: none;
		}
	</style>
	<script
	src="https://code.jquery.com/jquery-3.4.1.js"
	integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
	crossorigin="anonymous"></script>
	<script
	src="https://code.jquery.com/jquery-3.4.1.js"
	integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
	crossorigin="anonymous"></script>
	<script>
		function SubForm (){
			$.ajax({
				url:"https://api.apispreadsheets.com/data/15285/",
				type:"post",
				data:$("#getinfo").serializeArray(),
				success: function(){
					alert("Chúng mình nhận được rồi! Cảm ơn bạn nhiều <3 ")
					var idform = document.getElementById('getinfo');
					idform.style.display = 'none';
					var btnsubmit = document.getElementById('saveinfo');
					btnsubmit.style.display = 'none';
				},
				error: function(){
					alert("Oh noooo, lỗi rùi :( Bạn thử nhập lại nhé")
				}
			});
		}
	</script>
</head>
<body>
	<form id="getinfo"> 
		<label id = "txtname">Tên của bạn: </label><br>
		<input name="Name" id = "Name" />
		<br/>
		<label id = "txtcontact">Để lại link facebook/email hoặc số điện thoại nhe</label><br>
		<input name="Email/Facebook" id = "Contact"/>
		<input name="Time" id = "Time"/>
		<br/>
	</form>
	<button onclick='SubForm()' id = "saveinfo">Submit</button>
</br>
<div class = "allform">
	<button id = "htp" onclick = "showimg1()"> Cách chơi </button>
	<button id = "note" onclick = "showimg2()"> Lưu ý </button>
	<label id="minutes">00</label>
	<label id="colon">:</label>
	<label id="seconds">00</label>
	<button id = "htpim" onclick = "hideimg()"> -Bạn click vào các đoạn dây điện để xoay chúng, tạo thành mạch điện hoàn chỉnh nối "Start" với "Finish". <br> -Sau khi nối thành công, sẽ có khung để bạn điền thông tin, hãy điền vào để chúng mình có thể liên hệ nhéeeee </button>
	<button id = "noteim" onclick = "hideimg()"> -Bạn chỉ có thể xoay mỗi đoạn dây tối đa 4 lần. <br> -Đoạn dây "Start" và "Finish" được cố định, bạn không thể xoay chúng đâu nhé. 
	</button>
	<br>
</div>
<div id="board"></div>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7310599997431097"
     crossorigin="anonymous"></script>
<script type="text/javascript">
	function showimg1() {
		var x = document.getElementById("htpim");
		var y = document.getElementById("noteim");
		if (x.style.display === "block") x.style.display = "none";
		else x.style.display = "block";
		y.style.display = "none";
	}
	function showimg2() {
		var x = document.getElementById("noteim");
		var y = document.getElementById("htpim");
		if (x.style.display === "block") x.style.display = "none";
		else x.style.display = "block";
		y.style.display = "none";
	}
	function hideimg() {
		var x = document.getElementById("htpim");
		var y = document.getElementById("noteim");
		x.style.display = "none";
		y.style.display = "none";
	}
	var minutesLabel = document.getElementById("minutes");
	var secondsLabel = document.getElementById("seconds");
	var totalSeconds = 0;
	setInterval(setTime, 1000);

	function setTime()
	{
		if (!isPuzzleComplete)
			++totalSeconds;
		secondsLabel.innerHTML = pad(totalSeconds%60);
		minutesLabel.innerHTML = pad(parseInt(totalSeconds/60));
	}

	function pad(val)
	{
		var valString = val + "";
		if(valString.length < 2)
		{
			return "0" + valString;
		}
		else
		{
			return valString;
		}
	}
      	// type = 1 - thang, 2 - ngang, 3 - -|, 4 - _|, 5 - |_, 6 - |-
      	const type = ["3", "1", "5", "1", "2", "2", "1", "5", "3", "3", "3", 
      	"1", "3", "4", "1", "4", "2", "4", "1", "4", "2", "3",
      	"3", "4", "4", "5", "4", "5", "3", "4", "4", "3", "1",
      	"2", "2", "5", "2", "4", "2", "1", "6", "4", "1", "1",
      	"2", "2", "3", "1", "4", "1", "5", "1", "2", "1", "3",
      	"1", "3", "5", "5", "1", "3", "6", "4", "5", "2", "1",
      	"2", "4", "3", "3", "5", "4", "4", "2", "2", "1", "3",
      	"2", "3", "1", "1", "2", "2", "2", "3", "5", "3", "5",
      	"1", "2", "4", "1", "5", "2", "1", "1", "4", "4", "1",
      	"5", "3", "3", "2", "4", "1", "3", "4", "5", "2", "2",
      	"3", "2", "1", "1", "4", "5", "1", "2", "4", "5", "4"];
      	function flippz() {
      		var audio = new Audio("./sound/flip.mp3");
      		audio.play();
      	}

      	const playMusic = () => {
      		const musicFile = './sound/music.mp3'
      		const audio = new Audio(musicFile)
      		audio.volume = 0.35
      		audio.loop = true
      		audio.play()
      	}
      	const claphand = () => {
      		const sound1 = './sound/applause.mp3', sound2 = './sound/woohoo.mp3'
      		const audio1 = new Audio(sound1), audio2 = new Audio(sound2);
      		audio1.play()
      		audio2.play()
      	}
      	cant = new Map();
      	const idall = [...document.querySelectorAll('.card')]
      	idall.forEach(function(idc) {
      		cant.prototype.set(idc, false);
      	});
      	const handleCardClick = event => {
      		event.preventDefault()

      		const cardClicked = event.composedPath().find(element => (
      			[...element.classList].includes('card'))
      		)
      		const allCards = [...document.querySelectorAll('.card')]
      		if (!cardClicked.disabled && !cant[cardClicked] && cardClicked !== allCards[0] && cardClicked !== allCards[109]) {
      			cardClicked.disabled = true

      			const currentRotation = cardClicked.dataset.rotation
      			const newRotation = `${Number(currentRotation) + 1}`
      			flippz();
      			cardClicked.dataset.rotation = newRotation
      			if (newRotation === "4") {
      				cant.prototype.set(cardClicked, true);
      				const imageFragment = cardClicked.querySelector('.imageFragment')
      				cardClicked.addEventListener('transitionend', () => {
      					imageFragment.style.transitionDuration = "0s"
      					requestAnimationFrame(() => {
      						cardClicked.dataset.rotation = "0"
      						requestAnimationFrame(() => {
      							imageFragment.style.transitionDuration = ""
      						})
      					})
      				}, {once: true})
      				newRotation = "0"
      			}
      			isPuzzleComplete = false;
          // dr = 1 - up, 2 - down, 3 - left, 4 - right
          // type = 1 - thang, 2 - ngang, 3 - -|, 4 - _|, 5 - |_, 6 - |-
          var cur = 0, dr = "2", ok = false;
          if (allCards[108].dataset.rotation === "0" || allCards[108].dataset.rotation === "2")
          	if (allCards[11].dataset.rotation === "0" || allCards[11].dataset.rotation === "2") 
          		ok = true;
          	if (ok) {
          		var vis = new Array(125);
          		while (true) {
          			if (cur === 109) {
          				isPuzzleComplete = true; break;
          			}
          			if (dr === "1") {
          				if (cur - 11 < 0 || vis[cur - 11]) break;
          				cur -= 11;
          				var idrt = allCards[cur].dataset.rotation;
          				if (type[cur] === "1") {
          					if (idrt === "1" || idrt === "3")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "2") {
          					if (idrt === "0" || idrt === "2")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "3") {
          					if (idrt === "0") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "4") {
          					if (idrt === "2") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "5") {
          					if (idrt === "1") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					if (idrt === "2") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "6") {
          					if (idrt === "0") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					if (idrt === "1") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					break;
          				}
          			}
          			if (dr === "2") {
          				if (cur + 11 > 120 || vis[cur + 11]) break;
          				cur += 11;
          				var idrt = allCards[cur].dataset.rotation;
          				if (type[cur] === "1") {
          					if (idrt === "1" || idrt === "3")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "2") {
          					if (idrt === "0" || idrt === "2")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "3") {
          					if (idrt === "1") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					if (idrt === "2") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "4") {
          					if (idrt === "0") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					if (idrt === "1") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "5") {
          					if (idrt === "0") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "6") {
          					if (idrt === "2") {
          						dr = "3"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "4"; vis[cur] = true; continue;
          					}
          					break;
          				}
          			}
          			if (dr === "3") {
          				if (cur - 1 < 0 || vis[cur - 1]) break;
          				cur -= 1;
          				var idrt = allCards[cur].dataset.rotation;
          				if (type[cur] === "1") {
          					if (idrt === "0" || idrt === "2")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "2") {
          					if (idrt === "1" || idrt === "3")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "3") {
          					if (idrt === "2") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "4") {
          					if (idrt === "1") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					if (idrt === "2") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "5") {
          					if (idrt === "0") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					if (idrt === "1") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "6") {
          					if (idrt === "0") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					break;
          				}
          			}
          			if (dr === "4") {
          				if (cur + 1 > 120 || vis[cur + 1]) break;
          				cur += 1;
          				var idrt = allCards[cur].dataset.rotation;
          				if (type[cur] === "1") {
          					if (idrt === "0" || idrt === "2")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "2") {
          					if (idrt === "1" || idrt === "3")
          						break;
          					vis[cur] = true;
          					continue;
          				}
          				if (type[cur] === "3") {
          					if (idrt === "0") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					if (idrt === "1") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "4") {
          					if (idrt === "0") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "5") {
          					if (idrt === "2") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					if (idrt === "3") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					break;
          				}
          				if (type[cur] === "6") {
          					if (idrt === "1") {
          						dr = "2"; vis[cur] = true; continue;
          					}
          					if (idrt === "2") {
          						dr = "1"; vis[cur] = true; continue;
          					}
          					break;
          				}
          			}
          		}
          	}
          	if (isPuzzleComplete) {
          		allCards.forEach(card => card.disabled = true)
          		claphand();
          		alert("Mạch điện đã được nối thành công !!! Sau khi đóng thông báo này, sẽ có khung để bạn điền thông tin đấy. Cảm ơn bạn siêu nhiều vì đã tham gia minigame của chúng mình <3 ");
          		var idform = document.getElementById('getinfo');
          		idform.style.display = 'block';
          		var btnsubmit = document.getElementById('saveinfo');
          		btnsubmit.style.display = 'block';
          		var minu = document.getElementById("minutes").innerHTML;
          		var sec = document.getElementById("seconds").innerHTML;
          		var finishtime = minu*60+sec;
          		var cnttime = document.getElementById('Time');
          		cnttime.value = finishtime;
          	}
          	else {
          		cardClicked.addEventListener('transitionend', () => {
          			cardClicked.disabled = false
          		}, {once: true})
          	}
          }
      }

      const setupBoard = (size = 4) => {
      	const renderCard = (x, y) => `
      	<button
      	class="card"
      	data-rotation="0"
      	style="
      	width: ${(80 / size)}vmin;
      	height: ${(80 / size)}vmin;
      	"
      	>
      	<div
      	class="imageFragment"
      	style="
      	background-image: url('./img/wireimg.jpg');
      	background-position: ${y * (100 / (size - 1))}% ${x * (100 / (size - 1))}%;
      	background-size: ${(size) * 100}% ${(size) * 100}%;
      	"
      	></div>
      	</button>
      	`
      	const renderRow = children => `
      	<div class="row">${children}</div>
      	`
      	const indices = Array.from(Array(size).keys())
      	const boardHTML = indices.map(rowIndex => (
      		renderRow(
      			indices.map(columnIndex => (
      				renderCard(rowIndex, columnIndex)
      				)).join('')
      			)
      		)).join('')
      	document.getElementById('board').innerHTML = boardHTML
      	document.querySelectorAll('.card').forEach(card => {
      		card.addEventListener('click', handleCardClick)
      		card.addEventListener('contextmenu', handleCardClick)
      		card.addEventListener('auxclick', handleCardClick)
      	})
      }
      setupBoard(11)
      document.addEventListener('click', playMusic, {once: true})

  </script>
</body>
</html>
